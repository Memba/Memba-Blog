<!DOCTYPE html><html lang="en"><head><title>Memba Mini Blog Engine</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="author" content="Memba"><meta name="keywords" content="blog"><meta name="description" content="My Blog"><meta name="robots" content="nofollow"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon-precomposed" href="./styles/images/touch-icon-57-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="72x72" href="./styles/images/touch-icon-72-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="114x114" href="./styles/images/touch-icon-114-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="./styles/images/touch-icon-144-precomposed.png"><link rel="apple-touch-startup-image" href="./styles/images/splash.png"><link rel="shortcut icon" href="styles/images/favicon.png"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--><script type="text/javascript" charset="utf-8" src="js/vendor/modernizr.min.js"></script><script type="text/javascript" charset="utf-8" src="js/init.js"></script></head><body><article id="raw" style="display:none"></article><div id="application"></div><script id="application-layout" type="text/x-kendo-template"><!-- Header -->
    <header id="application-header"></header>
    <!-- Responsive grid-->
    <div id="application-container" class="container">
        <div class="row">
            <!-- Left -->
            <div id="index-view-left" class="col-lg-10 col-md-9 col-sm-8">
                <section id="content">
                </section>
            </div>
            <!-- Right -->
            <div id = "index-view-right" class="col-lg-2 col-md-3 col-sm-4">
                <section id="all-posts" class="side-section">
                    <h2 id="all-posts-title"><a href="#/"></a></h2><hr/>
                </section>
                <section id="categories" class="side-section"></section>
                <section id="archive" class="side-section"></section>
                <section id="rss" class="side-section">
                    <h2 id="rss-title"><a href="#"></a></h2><hr/>
                </section>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <footer id="application-footer"></footer>
    <!-- TODO: google analytics --></script><script id="categories-view" type="text/x-kendo-template"><h2 id="categories-title"></h2><hr/>
    <ul id="categories-list" data-role="listview" data-bind="source: categories" data-template="categories-list-template"></ul></script><script id="categories-list-template" type="text/x-kendo-template"><li class="categories">
        <a href="#= items[0].categoryLink #">#: value #</a>&nbsp;<span class="count">#: items.length#</span>
    </li></script><script id="archive-view" type="text/x-kendo-template"><h2 id="archive-title"></h2><hr/>
    <ul id="archive-list" data-role="listview" data-bind="source: archive" data-template="archive-list-template"></ul></script><script id="archive-list-template" type="text/x-kendo-template"><li class="archive">
        <a href="#= items[0].periodLink #">#: kendo.toString(items[0].pubDate, 'Y', app.resources.LOCALE) #</a>&nbsp;<span class="count">#: items.length#</span>
    </li></script><script id="list-view" type="text/x-kendo-template"><ul id="index-list" data-role="listview" data-bind="source: list" data-template="index-list-template"></ul>
    <div id="index-pager" data-role="pager" data-bind="source: list" data-page-sizes="true"></div></script><script id="index-list-template" type="text/x-kendo-template"><li>
        <article itemscope itemtype="http://schema.org/BlogPosting">
            <h1 itemprop="name"><a href="#: link #">#: title #</a></h1>
            <div class="authorship">
                <div class="pull-left"><i class="fa fa-user"></i>&nbsp;<span itemprop="author">#: author#</span></div>
                <div class="pull-right"><i class="fa fa-calendar"></i>&nbsp;<time itemprop="datePublished">#: kendo.toString(pubDate, 'dd MMM yyyy')#</time></div>
            </div>
            <div class="clearfix"></div>
            <div class="summary">
                <div class="thumb"><img src="#= enclosure #" alt="#: title #"></div>
                <div itemprop="description">#= description#</div>
            </div>
            <div class="clearfix"></div>
            <div class="readmore">
                <div class="pull-left"><a href="#= categoryLink #"><i class="fa fa-tag"></i>&nbsp;#: category #</a></div>
                <div class="pull-right"><a href="#= link #"></a></div>
            </div>
            <div class="clearfix"></div>
        </article>
        <hr>
    </li></script><script id="detail-view" type="text/x-kendo-template"><article itemscope itemtype="http://schema.org/BlogPosting"><!-- add about attribute -->
        <h1 itemprop="name" data-bind="text: title"></h1>
        <div class="authorship">
            <div class="pull-left"><i class="fa fa-user"></i>&nbsp;<span itemprop="author" data-bind="text: author"></span></div>
            <div class="pull-right"><i class="fa fa-calendar"></i>&nbsp;<time itemprop="datePublished" data-bind="text: pubDate"></time></div>
        </div>
        <div class="clearfix"></div>
        <div id="markdown" itemprop="text" data-role="markdown" data-bind="url: contentUrl"></div>
    </article>
    <!-- TODO http://jlchereau.disqus.com/admin/settings/universalcode/-->
    <!-- TODO: addthis --></script><script id="search-view" type="text/x-kendo-template"><h1 data-bind="text: search"></h1>
    <div id="search-results" data-role="websearch" data-engine="Google" data-key="000888210889775888983:tmhkkjoq81m" data-bind="value: search"></div></script><script id="faqs-view" type="text/x-kendo-template"><h1></h1>
    <div>lorem ipsum</div></script><script id="error-view" type="text/x-kendo-template"><h1></h1>
    <div class="alert alert-danger"></div></script><script>// Note: the following is pure JavaScript (no api) to be executed by search engine bots
    var LF = '\n', COLON = ':';
    /**
     * Returns an object containing metadata properties defined as key: value\n pairs at the beginning of the markdown file
     * Important Note: the following code should remain consistent with the code in memba.markdown.js and util.js
     * See: https://github.com/Memba/Memba-Widgets/blob/master/src/js/memba.markdown.js
     * See also: https://github.com/Memba/grunt-blog/blob/master/tasks/lib/util.js
     * See also: https://github.com/Memba/Memba-Blog/blob/master/src/index.html
     * @method getMetaData
     * @param stream
     * @returns {string}
     */
    function getMetaData(stream) {
        var buf = stream.trim().replace(/\r\n/gm, LF).replace(/\r/gm, LF),
                metaData = {},
                posLFLF = buf.indexOf(LF + LF);
        //key value pairs need to be separated from markdown by two line feeds \n\n
        if (posLFLF>0) {
            var hasMetaData = false,
                    rawMetaData = buf.substr(0, posLFLF).trim(),
                    lines = rawMetaData.split(LF).length,
            //key value pairs are in the form key: value\n
                    regex = /^(?:\s*)(\w+)(?:\s*)\:(?:\s*)([^\r\n]+)(?:\s*)$/gm,//TODO: improve but also update memba.markdown.js
                    matches = [];
            if(regex.test(rawMetaData)) {
                matches = rawMetaData.match(regex);
                hasMetaData = (matches.length === lines);
            }
            if(hasMetaData) {
                matches.forEach(function(match) {
                    try {
                        var posCOL = match.indexOf(COLON);
                        metaData[match.substr(0,posCOL).trim()] = match.substr(posCOL+1).trim();
                    } catch (err) { }
                });
            }
        }
        return metaData;
    };

    /**
     * Returns MarkDown only without carriage returns
     * Important Note: the following code should remain consistent with the code in memba.markdown.js and util.js
     * See: https://github.com/Memba/Memba-Widgets/blob/master/src/js/memba.markdown.js
     * See also: https://github.com/Memba/grunt-blog/blob/master/tasks/lib/util.js
     * See also: https://github.com/Memba/Memba-Blog/blob/master/src/index.html
     * @method getMarkDown
     * @param stream
     * @returns {string}
     */
    function getMarkDown(stream) {
        var buf = stream.trim().replace(/\r\n/gm, LF).replace(/\r/gm, LF),
                posLFLF = buf.indexOf(LF + LF);
        //key value pairs need to be separated from markdown by two line feeds \n\n
        if (posLFLF>0) {
            return buf.substr(posLFLF + 2).trim();
        } else {
            return buf;
        }
    };

    /**
     * Function to execute when the page is read from a search engine bot
     */
    (function() {
        //console.log('index.html: ' + window.location.search);
        if (window.location.search.length > 1) {
            var search = function() {
                var s = window.location.search.substr(1),
                        p = s.split(/\&/), l = p.length, kv, r = {};
                if (l === 0) {return false;}
                while (l--) {
                    kv = p[l].split(/\=/);
                    r[kv[0]] = decodeURIComponent(kv[1] || '') || true;
                }
                return r;
            }();
            if (search && search.r) {
                var oReq = new XMLHttpRequest();
                oReq.onload = function() {
                    var response = this.responseText,
                        metaData = getMetaData(response),
                        markDown = getMarkDown(response),
                        html = '',
                        head = document.getElementsByTagName('head')[0],
                        raw = document.getElementById('crawl');

                    //page title
                    if (head && metaData.title) {
                        var title = document.getElementsByTagName('title')[0];
                        if (!title) {
                            title = document.createElement('title');
                            head.appendChild(title);
                        }
                        title.innerText = metaData.title;
                        html += '<h1>' + metaData.title + '</h1>';
                    }
                    //page description (TODO and keywords?)
                    if(head && metaData.description) {
                        var found = false, metas = document.getElementsByTagName('meta');
                        for (var i = 0; i < metas.length; i++){
                            if (metas[i].name.toLowerCase() === 'description') {
                                metas[i].content = metaData.description;
                            }
                        }
                    }

                    //canonical URL
                    //var canonical = document.createElement('link'); canonical.rel = 'canonical'; canonical.href = '?????????????????';
                    //head.appendChild(canonical);

                    //set crawlable content after parsing for headings h1, h2 and h3
                    if(raw) {
                        html += markDown
                                .replace(/^[\s]*#[\s]*([^\#\r\n]+)[\#\r\n]*/gm, '\n<h1>$1</h1>\n')
                                .replace(/^[\s]*##[\s]*([^\#\r\n]+)[\#\r\n]*/gm, '\n<h2>$1</h2>\n')
                                .replace(/^[\s]*###[\s]*([^\#\r\n]+)[\#\r\n]*/gm, '\n<h3>$1</h3>\n');
                        raw.style.display = 'block';
                        raw.innerHTML = html;
                    }
                };
                //TODO: Read configuration for /blog/ and ./posts/ and extension
                oReq.open("get", search.r.replace('/blog/', './posts/') + '.md', true);
                oReq.send();
            }
        }
    })();</script></body></html>