// memba.blog 0.1.0 built on 03-02-2014 - Copyright (c) 2013-2014 Memba. All rights reserved.
!function(a){"use strict";var b=Function,c=b("return this")(),d=c.app=c.app||{};d.constants=a.extend(d.constants||{},{URN:"urn:",COLON:":",DEFAULT_GUID:"00000000-0000-0000-0000-000000000000",MARKDOWN_EXT:".md",PATH_SEP:"/",PAGE_SIZE:"pageSize",DEFAULT_PAGE_SIZE:5,DATE_FORMAT:"dd MMM yyyy",MAX_THUMBNAILS:4}),d.types=a.extend(d.types||{},{BOOLEAN:"boolean",DATE:"date",FUNCTION:"function",NUMBER:"number",OBJECT:"object",STRING:"string",UNDEFINED:"undefined"}),d.hrefs=a.extend(d.hrefs||{},{ARCHIVE:"./posts/",RSS:"index.rss",INDEX:"./index.html",HEADER:"./header.tmpl.html",FOOTER:"./footer.tmpl.html",CONFIG:"./config.json",THUMBNAIL:"./styles/images/blog{0}.jpg"}),d.routes=a.extend(d.routes||{},{HASH:"#",HOME:"/",PAGE:"/pages/:page",CATEGORY:"/category/:category",BLOG:"/blog(/:year)(/:month)(/:slug)",YEAR_PARAMETER:":year",MONTH_PARAMETER:":month",SLUG_PARAMETER:":slug",GUID:"/guid/:guid",SEARCH:"/search"}),d.events=a.extend(d.events||{},{CHANGE:"change",CLICK:"click",HIDE:"hide",INIT:"init",INITIALIZE:"initialize",KEYUP:"keyup",SHOW:"show"}),d.tags=a.extend(d.tags||{},{ALT:"alt",ARTICLE:"article",BODY:"body",DATA_COLUMNS:"data-columns",DIV:"div",DIV_ELEMENT:"<div/>",HEAD:"head",HEADING1:"h1",HREF:"href",ID:"id",IMG:"img",INPUT:"input",INPUT_ELEMENT:"<input/>",PLACEHOLDER:"placeholder",SPAN:"span",SPAN_ELEMENT:"<span/>",SRC:"src",TEXTAREA:"textarea",TEXTAREA_ELEMENT:"<textarea/>",TITLE:"title",TITLE_ELEMENT:"<title></title>"}),d.elements=a.extend(d.elements||{},{strip:function(a){return typeof a===d.types.STRING&&"#"===a.charAt(0)?a.substr(1):a},APPLICATION_ROOT:"#application",APPLICATION_LAYOUT:"#application-layout",APPLICATION_HEADER:"#header",APPLICATION_CONTAINER:"#container",APPLICATION_CONTENT:"#content",APPLICATION_SIDE:"#side",APPLICATION_FOOTER:"#footer",HEADER_VIEW:"#header-view",HEADER_VIEW_NAVBAR_BRAND:"#header-view-navbar-brand",HEADER_VIEW_NAVBAR_TOGGLE:"#header-view-navbar-toggle",HEADER_VIEW_NAVBAR_SEARCH_INPUT:"#header-view-navbar-search-input",HEADER_VIEW_NAVBAR_SEARCH_BUTTON:"#header-view-navbar-search-button",HEADER_VIEW_NAVBAR_MENU:"#header-view-navbar-menu",FOOTER_VIEW:"#footer-view",FOOTER_VIEW_COPYRIGHT:"#footer-view-copyright",PAGE_VIEW:"#page-view",SEARCH_VIEW:"#search-view",ERROR_VIEW:"#error-view",ERROR_VIEW_TITLE:"h1",ERROR_VIEW_MESSAGE:"div.alert",BLOG_NAVIGATION_VIEW:"#blog-navigation-view",ALL_POSTS_SECTION:"#all-posts",ALL_POSTS_SECTION_TITLE:"#all-posts-title > a",CATEGORIES_SECTION:"#categories",CATEGORIES_SECTION_TITLE:"#categories-title",ARCHIVE_SECTION:"#archive",ARCHIVE_SECTION_TITLE:"#archive-title",RSS_SECTION:"#rss",RSS_SECTION_TITLE:"#rss-title > a",BLOG_LIST_VIEW:"#blog-list-view",BLOG_LIST_TEMPLATE:"#blog-list-template",BLOG_PAGER:"#blog-pager",BLOG_PAGER_SIZES:"span.k-pager-sizes select",BLOG_POST_READMORE:"div.readmore > div.pull-right > a",DETAIL_VIEW:"#detail-view",DUMMY:"dummy"})}(jQuery),function(a,b){"use strict";var c=Function,d=c("return this")(),e=d.kendo,f=d.app,g=f.constants,h=f.elements,i=f.events,j=f.hrefs,k=f.routes,l=f.types,m=!1,n="app.controller.js: ",o={set:function(a,b){Modernizr.localstorage&&(d.localStorage[a]=b)},get:function(a){return Modernizr.localstorage?d.localStorage[a]:b}};a(document).bind(i.INITIALIZE,function(){m&&d.console&&console.log(n+"initialize event fired"),f.localize(f.config);var b=new e.Layout(h.APPLICATION_LAYOUT),c=new e.View(h.HEADER_VIEW,{model:f.searchViewModel}),p=new e.View(h.FOOTER_VIEW),q=new e.View(h.PAGE_VIEW,{model:f.pageViewModel}),r=new e.View(h.SEARCH_VIEW,{model:f.searchViewModel}),s=new e.View(h.ERROR_VIEW),t=new e.View(h.BLOG_NAVIGATION_VIEW,{model:f.blogNavigationViewModel}),u=new e.View(h.BLOG_LIST_VIEW,{model:f.blogListViewModel}),v=new e.View(h.DETAIL_VIEW,{model:f.blogPostViewModel}),w=new e.Router({init:function(){b.render(h.APPLICATION_ROOT),b.showIn(h.APPLICATION_HEADER,c),b.showIn(h.APPLICATION_FOOTER,p),b.showIn(h.APPLICATION_SIDE,t)},change:function(a){m&&d.console&&d.console.log(n+"Open view "+a.url)},routeMissing:function(a){m&&d.console&&d.console.log(n+"Route missing at "+a.url),b.showIn(h.APPLICATION_CONTENT,s)}});m&&d.console&&console.log(n+"views and router initialized"),w.route(k.HOME,function(){if(a.type(f.config.home)===l.STRING&&f.config.home.length>0)f.pageViewModel.set("contentUrl",f.config.home),b.showIn(h.APPLICATION_CONTENT,q),t.hide();else{var c=f.blogListViewModel.get("list");c.filter(null),c.sort()||c.sort({field:"pubDate",dir:"desc"}),c.pageSize(o.get(g.PAGE_SIZE)||g.DEFAULT_PAGE_SIZE),b.showIn(h.APPLICATION_CONTENT,u),b.showIn(h.APPLICATION_SIDE,t)}}),w.route(k.PAGE,function(a){f.pageViewModel.set("contentUrl","./pages/"+a+g.MARKDOWN_EXT),b.showIn(h.APPLICATION_CONTENT,q),t.hide()}),w.route(k.CATEGORY,function(a){var c=f.blogListViewModel.get("list");c.filter({field:"category",operator:"eq",value:a}),c.pageSize(o.get(g.PAGE_SIZE)||g.DEFAULT_PAGE_SIZE),b.showIn(h.APPLICATION_CONTENT,u),b.showIn(h.APPLICATION_SIDE,t)}),w.route(k.BLOG,function(c,d,i){var k=f.blogListViewModel.get("list");if(a.type(i)===l.STRING){var m=a.grep(k.data(),function(a){return a.link.indexOf(c+g.PATH_SEP+d+g.PATH_SEP+i)>0});m.length>0&&(f.blogPostViewModel.set("contentUrl",j.ARCHIVE+c+g.PATH_SEP+d+g.PATH_SEP+i+g.MARKDOWN_EXT),f.blogPostViewModel.set("title",m[0].title),f.blogPostViewModel.set("author",m[0].author),f.blogPostViewModel.set("pubDate",e.toString(m[0].pubDate,g.DATE_FORMAT)),b.showIn(h.APPLICATION_CONTENT,v))}else k.filter(isNaN(parseInt(d))?isNaN(parseInt(c))?null:{field:"period",operator:"startsWith",value:c}:{field:"period",operator:"eq",value:c+"/"+d}),k.sort()||k.sort({field:"pubDate",dir:"desc"}),k.pageSize(o.get(g.PAGE_SIZE)||g.DEFAULT_PAGE_SIZE),b.showIn(h.APPLICATION_CONTENT,u);b.showIn(h.APPLICATION_SIDE,t)}),w.route(k.GUID,function(a){var c=f.blogListViewModel.get("list"),d=c.get(a);if(d){var i=new RegExp(k.HASH+k.BLOG.replace(k.YEAR_PARAMETER,"([^/]+)").replace(k.MONTH_PARAMETER,"([^/]+)").replace(k.SLUG_PARAMETER,"([^/]+)")+"$"),l=i.exec(d.link);f.blogPostViewModel.set("url",j.ARCHIVE+l[1]+g.PATH_SEP+l[2]+g.MARKDOWN_EXT),f.blogPostViewModel.set("title",d.title),f.blogPostViewModel.set("author",d.author),f.blogPostViewModel.set("pubDate",e.toString(d.pubDate,g.DATE_FORMAT)),b.showIn(h.APPLICATION_CONTENT,v),b.showIn(h.APPLICATION_SIDE,t)}}),w.route(k.SEARCH,function(){b.showIn(h.APPLICATION_CONTENT,r),t.hide()}),m&&d.console&&d.console.log(n+"routes configured"),a(window).keydown(function(b){return 13==b.keyCode?(a(h.HEADER_VIEW_NAVBAR_SEARCH_INPUT).val().trim().length>0&&a(h.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).trigger(i.CLICK),b.preventDefault(),!1):!0}),q.bind(i.INIT,function(a){a.sender.element.find("[data-role=markdown]").data("kendoMarkDown").bind(i.CHANGE,function(a){m&&d.console.log&&d.console.log(n+"new markdown loaded"),f.setMetaTags(a.sender.metadata(),f.config)})}),v.bind(i.INIT,function(a){a.sender.element.find("[data-role=markdown]").data("kendoMarkDown").bind(i.CHANGE,function(a){m&&d.console.log&&d.console.log(n+"new markdown loaded"),f.setMetaTags(a.sender.metadata(),f.config)})}),t.bind(i.SHOW,function(){m&&d.console.log&&d.console.log(n+"blog navigation shown"),a(h.APPLICATION_CONTENT).removeClass("col-lg-12 col-md-12 col-sm-12"),a(h.APPLICATION_CONTENT).addClass("col-lg-10 col-md-9 col-sm-8 spacing"),a(h.APPLICATION_SIDE).removeClass("hidden"),a(h.APPLICATION_SIDE).addClass("col-lg-2 col-md-3 col-sm-4")}),t.bind(i.HIDE,function(){m&&d.console.log&&d.console.log(n+"blog navigation hidden"),a(h.APPLICATION_CONTENT).removeClass("col-lg-10 col-md-9 col-sm-8 spacing"),a(h.APPLICATION_CONTENT).addClass("col-lg-12 col-md-12 col-sm-12"),a(h.APPLICATION_SIDE).removeClass("col-lg-2 col-md-3 col-sm-4"),a(h.APPLICATION_SIDE).addClass("hidden")}),a(h.HEADER_VIEW_NAVBAR_SEARCH_INPUT).bind(i.KEYUP,function(b){a(b.target).val().trim().length>0?a(h.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).removeClass("disabled"):a(h.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).addClass("disabled")}),a(h.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).bind(i.CLICK,function(){w.navigate(k.SEARCH)}),a(h.BLOG_PAGER).find(h.BLOG_PAGER_SIZES).bind(i.CHANGE,function(a){o.set(g.PAGE_SIZE,e.parseInt(a.target.value))}),m&&d.console&&console.log(n+"events bound"),w.start(),m&&d.console&&d.console.log(n+"router started")})}(jQuery),function(a){"use strict";var b=Function,c=b("return this")(),d=c.kendo,e=c.app,f=e.elements,g=e.hrefs,h=e.tags,i=e.types,j="<wrap>",k="</wrap>",l=!1,m="app.localizer.js: ";e.localize=function(b){l&&c.console&&c.console.log(m+"starting localization; config and external templates should have been loaded beforehand"),d.culture(b.language);var e;if(1===a(f.HEADER_VIEW).length){e=a(j+a(f.HEADER_VIEW).html()+k),e.find(f.HEADER_VIEW_NAVBAR_BRAND+" "+h.IMG).attr(h.SRC,b.logo).attr(h.ALT,b.title),e.find(f.HEADER_VIEW_NAVBAR_TOGGLE).html(b.blog.navigation.toggle),Modernizr.input.placeholder&&e.find(f.HEADER_VIEW_NAVBAR_SEARCH_INPUT).attr(h.PLACEHOLDER,b.search.placeholder),e.find(f.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).html(b.search.button);var n=e.find(f.HEADER_VIEW_NAVBAR_MENU);a.each(b.menu,function(b,c){if(a.type(c.href)!==i.STRING||c.items){if(!c.href&&a.isArray(c.items)&&c.items.length>0){var e=a('<li class="dropdown"></li>');e.append(d.format('<a href="#" class="dropdown-toggle" data-toggle="dropdown">{0}<b class="caret"></b></a>',c.text));var f=a('<ul class="dropdown-menu"></ul>');a.each(c.items,function(a,b){f.append(b.text&&b.href?d.format('<li><a href="{0}">{1}</a></li>',b.href,b.text):'<li class="divider"></li>')}),e.append(f),n.append(e)}}else n.append(d.format('<li><a href="{0}">{1}</a></li>',c.href,c.text))}),a(f.HEADER_VIEW).html(e.html())}1===a(f.FOOTER_VIEW).length&&(e=a(j+a(f.FOOTER_VIEW).html()+k),e.find(f.FOOTER_VIEW_COPYRIGHT).html(b.copyright),a(f.FOOTER_VIEW).html(e.html())),1===a(f.ERROR_VIEW).length&&(e=a(j+a(f.ERROR_VIEW).html()+k),e.find(f.ERROR_VIEW_TITLE).html(b.errors.error404.title),e.find(f.ERROR_VIEW_MESSAGE).html(b.errors.error404.message),a(f.ERROR_VIEW).html(e.html())),1===a(f.BLOG_NAVIGATION_VIEW).length&&(e=a(j+a(f.BLOG_NAVIGATION_VIEW).html()+k),e.find(f.ALL_POSTS_SECTION_TITLE).html(b.blog.navigation.allposts),e.find(f.CATEGORIES_SECTION_TITLE).html(b.blog.navigation.categories),e.find(f.ARCHIVE_SECTION_TITLE).html(b.blog.navigation.archive),e.find(f.RSS_SECTION_TITLE).html(b.blog.navigation.rssfeed).attr(h.HREF,g.ARCHIVE+g.RSS),a(f.BLOG_NAVIGATION_VIEW).html(e.html())),1===a(f.BLOG_LIST_TEMPLATE).length&&(e=a(j+a(f.BLOG_LIST_TEMPLATE).html()+k),e.find(f.BLOG_POST_READMORE).html(b.blog.readmore),a(f.BLOG_LIST_TEMPLATE).html(e.html())),l&&c.console&&c.console.log(m+"localization completed")},e.setMetaTags=function(b,c){var d=a(h.HEAD);if(d.length>0&&(b.title||c.title)){var e=d.find(h.TITLE);0===e.length&&(e=a(h.TITLE_ELEMENT),d.prepend(e)),e.text(b.title||c.title)}var f=a(h.ARTICLE+" "+h.HEADING1);f.length>0&&(b.title||c.title)&&f.text(b.title||c.title)}}(jQuery),function(a){"use strict";var b=Function,c=b("return this")(),d=c.kendo,e=c.app,f=e.constants,g=e.hrefs,h=e.routes,i=e.types,j=!1,k="app.index.viewmodels.js: ",l=new d.data.DataSource({}),m=new d.data.DataSource({}),n=new d.data.DataSource({}),o=new d.data.DataSource({transport:{read:{url:g.ARCHIVE+g.RSS,dataType:"xml"}},schema:{type:"xml",data:"/rss/channel/item",model:{id:"guid",fields:{guid:{field:"guid/text()",type:i.STRING,editable:!1,defaultValue:f.DEFAULT_GUID,parse:function(a){if(0===a.indexOf(f.URN)){var b=a.substr(f.URN.length).indexOf(f.COLON);if(b>0)return a.substr(f.URN.length+b+1)}return a}},title:{field:"title/text()",type:i.STRING,editable:!1},link:{field:"link/text()",type:i.STRING,editable:!1,parse:function(b){if(a.type(b)===i.STRING){var c=b.indexOf(h.HASH);if(c>=0)return b.substr(c)}return b}},description:{field:"description/text()",type:i.STRING,editable:!1},enclosure:{field:"enclosure/@url",type:i.STRING,editable:!1,parse:function(b){return a.type(b)===i.STRING?b:d.format(g.THUMBNAIL,Math.floor(1+f.MAX_THUMBNAILS*Math.random()))}},author:{field:"author/text()",type:i.STRING,editable:!1},pubDate:{field:"pubDate/text()",type:i.DATE,editable:!1,parse:function(a){return j&&c.console.log&&c.console.log(k+"parse value "+a),d.parseDate(a)}},period:{field:"pubDate/text()",type:i.STRING,editable:!1,parse:function(a){var b=d.parseDate(a);return d.toString(b,"yyyy/MM")}},category:{field:"category/text()",type:i.STRING,editable:!1}}}},change:function(a){j&&c.console&&console.log(k+"Fetched "+a.items.length+" blogs"),a.sender instanceof d.data.DataSource&&(l.data(a.sender.data()),l.group({field:"category"}),m.data(a.sender.data()),m.group({field:"period"}),n.data(a.sender.data()))},error:function(b){j&&c.console&&a.type(c.console.error)===i.FUNCTION&&c.console.error(k+"error "+b.errorThrown)}});o.read(),e.pageViewModel=d.observable({contentUrl:"",title:""}),e.searchViewModel=d.observable({search:""}),e.blogNavigationViewModel=d.observable({_categories:l,categories:function(){return this.get("_categories").view()},_archive:m,archive:function(){return this.get("_archive").view()}}),e.blogListViewModel=d.observable({list:n}),e.blogPostViewModel=d.observable({contentUrl:"",title:"",author:"",pubDate:Date.now()}),d.data.binders.widget.url=d.data.Binder.extend({init:function(a,b,c){d.data.Binder.fn.init.call(this,a.element[0],b,c)},refresh:function(){var b=this,c=b.bindings.url.get(),e=a(b.element).data("kendoMarkDown");e instanceof d.ui.MarkDown&&e.url(c)}})}(jQuery);