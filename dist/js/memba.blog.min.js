// memba.blog 0.1.0 built on 16-01-2014 - Copyright (c) 2013-2014 Memba. All rights reserved.
!function(a){"use strict";var b=Function,c=b("return this")(),d=c.app=c.app||{};d.constants=a.extend(d.constants||{},{URN:"urn:",COLON:":",DEFAULT_GUID:"00000000-0000-0000-0000-000000000000",MARKDOWN_EXT:".md",PATH_SEP:"/",PAGE_SIZE:"pageSize",DEFAULT_PAGE_SIZE:5,DATE_FORMAT:"dd MMM yyyy",MAX_THUMBNAILS:4}),d.types=a.extend(d.types||{},{BOOLEAN:"boolean",DATE:"date",FUNCTION:"function",NUMBER:"number",OBJECT:"object",STRING:"string",UNDEFINED:"undefined"}),d.hrefs=a.extend(d.hrefs||{},{ARCHIVE:"./archive/",RSS:"index.rss",INDEX:"./index.html",HEADER:"./header.tmpl.html",FOOTER:"./footer.tmpl.html",THUMBNAIL:"./styles/images/blog{0}.jpg"}),d.routes=a.extend(d.routes||{},{HASH:"#",HOME:"/",CATEGORY:"/category/:category",CATEGORY_PARAMETER:":category",ARCHIVE:"/archive/:period",PERIOD_PARAMETER:":period",DETAIL:"/blog/:year/:month/:slug",YEAR_PARAMETER:":year",MONTH_PARAMETER:":month",SLUG_PARAMETER:":slug",GUID:"/guid/:guid",GUID_PARAMETER:":guid",SEARCH:"/search",FAQS:"/faqs"}),d.events=a.extend(d.events||{},{CHANGE:"change",CLICK:"click",DBLCLICK:"dblclick",DRAGSTART:"dragstart",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",INITIALIZE:"initialize",KEYUP:"keyup"}),d.tags=a.extend(d.tags||{},{BODY:"body",DATA_COLUMNS:"data-columns",DIV:"div",DIV_ELEMENT:"<div/>",HREF:"href",ID:"id",INPUT:"input",INPUT_ELEMENT:"<input/>",PLACEHOLDER:"placeholder",SPAN:"span",SPAN_ELEMENT:"<span/>",TEXTAREA:"textarea",TEXTAREA_ELEMENT:"<textarea/>"}),d.elements=a.extend(d.elements||{},{strip:function(a){return typeof a===d.types.STRING&&"#"===a.charAt(0)?a.substr(1):a},APPLICATION_ROOT:"#application",APPLICATION_LAYOUT:"#application-layout",APPLICATION_HEADER:"#application-header",APPLICATION_CONTAINER:"#application-container",APPLICATION_FOOTER:"#application-footer",CONTENT_SECTION:"#content",HEADER_VIEW:"#header-view",HEADER_VIEW_SEARCH_INPUT:"#header-view-navbar-search-input",HEADER_VIEW_SEARCH_BUTTON:"#header-view-navbar-search-button",HEADER_VIEW_NAVBAR_TOGGLE:"#header-view-navbar-toggle",HEADER_VIEW_NAVBAR_SEARCH_INPUT:"#header-view-navbar-search-input",HEADER_VIEW_NAVBAR_SEARCH_BUTTON:"#header-view-navbar-search-button",HEADER_VIEW_NAVBAR_MENU:"#header-view-navbar-menu",FOOTER_VIEW:"#footer-view",FOOTER_VIEW_COPYRIGHT:"#footer-view-copyright",ALL_POSTS_SECTION:"#all-posts",ALL_POSTS_SECTION_TITLE:"#all-posts-title > a",CATEGORIES_SECTION:"#categories",CATEGORIES_SECTION_TITLE:"#categories-title",CATEGORIES_VIEW:"#categories-view",ARCHIVE_SECTION:"#archive",ARCHIVE_SECTION_TITLE:"#archive-title",ARCHIVE_VIEW:"#archive-view",RSS_SECTION:"#rss",RSS_SECTION_TITLE:"#rss-title > a",LIST_VIEW:"#list-view",INDEX_LIST_TEMPLATE:"#index-list-template",ARTICLE_READMORE:"div.readmore > div.pull-right > a",INDEX_PAGER:"#index-pager",INDEX_PAGER_SIZES:"span.k-pager-sizes select",DETAIL_VIEW:"#detail-view",SEARCH_VIEW:"#search-view",FAQS_VIEW:"#faqs-view",ERROR_VIEW:"#error-view",ERROR_VIEW_TITLE:"h1",ERROR_VIEW_MESSAGE:"div.alert",DUMMY:"dummy"})}(jQuery),function(a,b){"use strict";var c=Function,d=c("return this")(),e=d.kendo,f=d.app,g=f.constants,h=f.elements,i=f.events,j=f.hrefs,k=f.routes,l=(f.tags,f.types,!1),m="app.controller.js: ",n={set:function(a,b){Modernizr.localstorage&&(d.localStorage[a]=b)},get:function(a){return Modernizr.localstorage?d.localStorage[a]:b}};a(document).bind(i.INITIALIZE,function(){l&&d.console&&console.log(m+"initialize event fired"),f.localize(f.resources);var b=new e.Layout(h.APPLICATION_LAYOUT),c=new e.View(h.HEADER_VIEW,{model:f.searchViewModel}),o=new e.View(h.FOOTER_VIEW),p=new e.View(h.CATEGORIES_VIEW,{model:f.categoriesViewModel}),q=new e.View(h.ARCHIVE_VIEW,{model:f.archiveViewModel}),r=new e.View(h.LIST_VIEW,{model:f.listViewModel}),s=new e.View(h.DETAIL_VIEW,{model:f.detailViewModel}),t=new e.View(h.SEARCH_VIEW,{model:f.searchViewModel}),u=new e.View(h.ERROR_VIEW),v=new e.Router({init:function(){b.render(h.APPLICATION_ROOT),b.showIn(h.APPLICATION_HEADER,c),b.showIn(h.APPLICATION_FOOTER,o),b.showIn(h.CATEGORIES_SECTION,p),b.showIn(h.ARCHIVE_SECTION,q)},change:function(a){l&&d.console&&d.console.log(m+"Open view "+a.url)},routeMissing:function(a){l&&d.console&&d.console.log(m+"Route missing at "+a.url),b.showIn(h.CONTENT_SECTION,u)}});v.route(k.HOME,function(){var a=f.listViewModel.get("list");a.filter(null),a.pageSize(n.get(g.PAGE_SIZE)||g.DEFAULT_PAGE_SIZE),b.showIn(h.CONTENT_SECTION,r)}),v.route(k.CATEGORY,function(a){var c=f.listViewModel.get("list");c.filter({field:"category",operator:"eq",value:a}),c.pageSize(n.get(g.PAGE_SIZE)||g.DEFAULT_PAGE_SIZE),b.showIn(h.CONTENT_SECTION,r)}),v.route(k.ARCHIVE,function(a){var c=f.listViewModel.get("list");a.length<6?c.filter({field:"period",operator:"startswith",value:a}):c.filter({field:"period",operator:"eq",value:a}),c.pageSize(n.get(g.PAGE_SIZE)||g.DEFAULT_PAGE_SIZE),b.showIn(h.CONTENT_SECTION,r)}),v.route(k.DETAIL,function(c,d,i){var k=f.listViewModel.get("list"),l=a.grep(k.data(),function(a){return a.link.indexOf(c+g.PATH_SEP+d+g.PATH_SEP+i)>0});l.length>0&&(f.detailViewModel.set("contentUrl",j.ARCHIVE+c+g.PATH_SEP+d+g.PATH_SEP+i+g.MARKDOWN_EXT),f.detailViewModel.set("title",l[0].title),f.detailViewModel.set("author",l[0].author),f.detailViewModel.set("pubDate",e.toString(l[0].pubDate,g.DATE_FORMAT)),b.showIn(h.CONTENT_SECTION,s))}),v.route(k.GUID,function(a){var c=f.listViewModel.get("list"),d=c.get(a);if(d){var i=new RegExp(k.HASH+k.DETAIL.replace(k.YEAR_PARAMETER,"([^/]+)").replace(k.MONTH_PARAMETER,"([^/]+)").replace(k.SLUG_PARAMETER,"([^/]+)")+"$"),l=i.exec(d.link);f.detailViewModel.set("url",j.ARCHIVE+l[1]+g.PATH_SEP+l[2]+g.MARKDOWN_EXT),f.detailViewModel.set("title",d.title),f.detailViewModel.set("author",d.author),f.detailViewModel.set("pubDate",e.toString(d.pubDate,g.DATE_FORMAT)),b.showIn(h.CONTENT_SECTION,s)}}),v.route(k.SEARCH,function(){b.showIn(h.CONTENT_SECTION,t)}),v.start(),a(window).keydown(function(b){return 13==b.keyCode?(a(h.HEADER_VIEW_SEARCH_INPUT).val().trim().length>0&&a(h.HEADER_VIEW_SEARCH_BUTTON).trigger(i.CLICK),b.preventDefault(),!1):void 0}),a(h.HEADER_VIEW_SEARCH_INPUT).bind(i.KEYUP,function(b){a(b.target).val().trim().length>0?a(h.HEADER_VIEW_SEARCH_BUTTON).removeClass("disabled"):a(h.HEADER_VIEW_SEARCH_BUTTON).addClass("disabled")}),a(h.HEADER_VIEW_SEARCH_BUTTON).bind(i.CLICK,function(){v.navigate(k.SEARCH)}),a(h.INDEX_PAGER).find(h.INDEX_PAGER_SIZES).bind(i.CHANGE,function(a){n.set(g.PAGE_SIZE,e.parseInt(a.target.value))})})}(jQuery),function(a){"use strict";var b=Function,c=b("return this")(),d=c.kendo,e=c.app,f=e.elements,g=e.hrefs,h=e.tags,i=!1,j="app.localizer.js: ",k="<wrap>",l="</wrap>";e.localize=function(b){var e,m=b.LOCALE||(c.navigator.userLanguage||c.navigator.language).substr(0,2);if(i&&c.console&&(c.console.log(j+"external templates should be loaded before starting localization"),c.console.log(j+"starting localization in "+m)),d.culture(m),1===a(f.APPLICATION_LAYOUT).length&&(e=a(k+a(f.APPLICATION_LAYOUT).html()+l),e.find(f.ALL_POSTS_SECTION_TITLE).html(b.ALL_POSTS_SECTION_TITLE),e.find(f.RSS_SECTION_TITLE).html(b.RSS_SECTION_TITLE).attr(h.HREF,g.ARCHIVE+g.RSS),a(f.APPLICATION_LAYOUT).html(e.html())),1===a(f.HEADER_VIEW).length){e=a(k+a(f.HEADER_VIEW).html()+l),e.find(f.HEADER_VIEW_NAVBAR_TOGGLE).html(b.HEADER_VIEW_NAVBAR_TOGGLE),Modernizr.input.placeholder&&e.find(f.HEADER_VIEW_NAVBAR_SEARCH_INPUT).attr(h.PLACEHOLDER,b.HEADER_VIEW_NAVBAR_SEARCH_INPUT),e.find(f.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).html(b.HEADER_VIEW_NAVBAR_SEARCH_BUTTON);var n=e.find(f.HEADER_VIEW_NAVBAR_MENU);a.each(b.HEADER_VIEW_NAVBAR_MENU,function(b,c){var d=a('<li class="dropdown"></li>');d.append('<a href="#" class="dropdown-toggle" data-toggle="dropdown">'+c.text+'<b class="caret"></b></a>');var e=a('<ul class="dropdown-menu"></ul>');a.each(c.items,function(a,b){b.text&&b.href?e.append('<li><a href="'+b.href+'">'+b.text+"</a></li>"):e.append('<li class="divider"></li>')}),d.append(e),n.append(d)}),a(f.HEADER_VIEW).html(e.html())}1===a(f.FOOTER_VIEW).length&&(e=a(k+a(f.FOOTER_VIEW).html()+l),e.find(f.FOOTER_VIEW_COPYRIGHT).html(b.FOOTER_VIEW_COPYRIGHT),a(f.FOOTER_VIEW).html(e.html())),1===a(f.CATEGORIES_VIEW).length&&(e=a(k+a(f.CATEGORIES_VIEW).html()+l),e.find(f.CATEGORIES_SECTION_TITLE).html(b.CATEGORIES_SECTION_TITLE),a(f.CATEGORIES_VIEW).html(e.html())),1===a(f.ARCHIVE_VIEW).length&&(e=a(k+a(f.ARCHIVE_VIEW).html()+l),e.find(f.ARCHIVE_SECTION_TITLE).html(b.ARCHIVE_SECTION_TITLE),a(f.ARCHIVE_VIEW).html(e.html())),1===a(f.INDEX_LIST_TEMPLATE).length&&(e=a(k+a(f.INDEX_LIST_TEMPLATE).html()+l),e.find(f.ARTICLE_READMORE).html(b.ARTICLE_READMORE),a(f.INDEX_LIST_TEMPLATE).html(e.html())),1===a(f.ERROR_VIEW).length&&(e=a(k+a(f.ERROR_VIEW).html()+l),e.find(f.ERROR_VIEW_TITLE).html(b.ERROR_VIEW_TITLE),e.find(f.ERROR_VIEW_MESSAGE).html(b.ERROR_VIEW_MESSAGE),a(f.ERROR_VIEW).html(e.html()))}}(jQuery),function(a){"use strict";var b=Function,c=b("return this")(),d=c.kendo,e=c.app,f=e.constants,g=e.hrefs,h=e.routes,i=e.types,j=!1,k="app.index.viewmodels.js: ",l=(d.data.Model.define({}),new d.data.DataSource({})),m=new d.data.DataSource({}),n=new d.data.DataSource({}),o=new d.data.DataSource({transport:{read:{url:g.ARCHIVE+g.RSS,dataType:"xml"}},schema:{type:"xml",data:"/rss/channel/item",model:{id:"guid",fields:{guid:{field:"guid/text()",type:i.STRING,editable:!1,defaultValue:f.DEFAULT_GUID,parse:function(a){if(0===a.indexOf(f.URN)){var b=a.substr(f.URN.length).indexOf(f.COLON);if(b>0)return a.substr(f.URN.length+b+1)}return a}},title:{field:"title/text()",type:i.STRING,editable:!1},link:{field:"link/text()",type:i.STRING,editable:!1,parse:function(b){if(a.type(b)===i.STRING){var c=b.indexOf(h.HASH);if(c>=0)return b.substr(c)}return b}},description:{field:"description/text()",type:i.STRING,editable:!1},enclosure:{field:"enclosure/@url",type:i.STRING,editable:!1,parse:function(b){return a.type(b)===i.STRING?b:d.format(g.THUMBNAIL,Math.floor(1+f.MAX_THUMBNAILS*Math.random()))}},author:{field:"author/text()",type:i.STRING,editable:!1},pubDate:{field:"pubDate/text()",type:i.DATE,editable:!1,parse:function(a){return j&&c.console.log&&c.console.log(k+"parse value "+a),d.parseDate(a)}},period:{field:"pubDate/text()",type:i.STRING,editable:!1,parse:function(a){var b=d.parseDate(a);return d.toString(b,"yyyyMM")}},periodLink:{field:"pubDate/text()",type:i.STRING,editable:!1,parse:function(a){var b=d.parseDate(a);return g.INDEX+h.HASH+h.ARCHIVE.replace(h.PERIOD_PARAMETER,encodeURIComponent(d.toString(b,"yyyyMM")))}},category:{field:"category/text()",type:i.STRING,editable:!1},categoryLink:{field:"category/text()",type:i.STRING,editable:!1,parse:function(a){return g.INDEX+h.HASH+h.CATEGORY.replace(h.CATEGORY_PARAMETER,encodeURIComponent(a))}}}}},change:function(a){j&&c.console&&console.log(k+"Fetched "+a.items.length+" blogs"),a.sender instanceof d.data.DataSource&&(l.data(a.sender.data()),l.group({field:"category"}),m.data(a.sender.data()),m.group({field:"period"}),n.data(a.sender.data()))},error:function(b){j&&c.console&&a.type(c.console.error)===i.FUNCTION&&c.console.error(k+"Error %O",b.errors)}});o.read(),e.searchViewModel=d.observable({search:""}),e.categoriesViewModel=d.observable({_categories:l,categories:function(){return this.get("_categories").view()}}),e.archiveViewModel=d.observable({_archive:m,archive:function(){return this.get("_archive").view()}}),e.listViewModel=d.observable({list:n}),e.detailViewModel=d.observable({contentUrl:"",title:"",author:"",pubDate:Date.now()}),d.data.binders.widget.url=d.data.Binder.extend({init:function(a,b,c){d.data.Binder.fn.init.call(this,a.element[0],b,c)},refresh:function(){var b=this,c=b.bindings.url.get(),e=a(b.element).data("kendoMarkDown");e instanceof d.ui.MarkDown&&e.url(c)}})}(jQuery);