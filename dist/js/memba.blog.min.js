// memba.blog 0.1.0 built on 07-02-2014 - Copyright (c) 2013-2014 Memba. All rights reserved.
!function(a){"use strict";var b=Function,c=b("return this")(),d=c.app=c.app||{};d.constants=a.extend(d.constants||{},{URN:"urn:",COLON:":",DEFAULT_GUID:"00000000-0000-0000-0000-000000000000",MARKDOWN_EXT:".md",PATH_SEP:"/",PAGE_SIZE:"pageSize",DEFAULT_PAGE_SIZE:5,DATE_FORMAT:"dd MMM yyyy",MAX_THUMBNAILS:4}),d.types=a.extend(d.types||{},{BOOLEAN:"boolean",DATE:"date",FUNCTION:"function",NUMBER:"number",OBJECT:"object",STRING:"string",UNDEFINED:"undefined"}),d.routes=a.extend(d.routes||{},{HASH:"#",HOME:"/",PAGE:"/pages/:page",CATEGORY:"/category/:category",BLOG:"/blog(/:year)(/:month)(/:slug)",YEAR_PARAMETER:":year",MONTH_PARAMETER:":month",SLUG_PARAMETER:":slug",GUID:"/guid/:guid",SEARCH:"/search"}),d.events=a.extend(d.events||{},{CHANGE:"change",CLICK:"click",HIDE:"hide",INIT:"init",INITIALIZE:"initialize",KEYUP:"keyup",SHOW:"show"}),d.tags=a.extend(d.tags||{},{ALT:"alt",ARTICLE:"article",BODY:"body",DATA_COLUMNS:"data-columns",DIV:"div",DIV_ELEMENT:"<div/>",HEAD:"head",HEADING1:"h1",HREF:"href",ID:"id",IMG:"img",INPUT:"input",INPUT_ELEMENT:"<input/>",PLACEHOLDER:"placeholder",SPAN:"span",SPAN_ELEMENT:"<span/>",SRC:"src",TEXTAREA:"textarea",TEXTAREA_ELEMENT:"<textarea/>",TITLE:"title",TITLE_ELEMENT:"<title></title>"}),d.elements=a.extend(d.elements||{},{strip:function(a){return typeof a===d.types.STRING&&"#"===a.charAt(0)?a.substr(1):a},APPLICATION_ROOT:"#application",APPLICATION_LAYOUT:"#application-layout",APPLICATION_HEADER:"#header",APPLICATION_CONTAINER:"#container",APPLICATION_MAIN:"#main",APPLICATION_CONTENT:"#content",APPLICATION_COMMENTS:"#comments",APPLICATION_SIDE:"#side",APPLICATION_FOOTER:"#footer",HEADER_VIEW:"#header-view",HEADER_VIEW_NAVBAR_BRAND:"#header-view-navbar-brand",HEADER_VIEW_NAVBAR_TOGGLE:"#header-view-navbar-toggle",HEADER_VIEW_NAVBAR_SEARCH_INPUT:"#header-view-navbar-search-input",HEADER_VIEW_NAVBAR_SEARCH_BUTTON:"#header-view-navbar-search-button",HEADER_VIEW_NAVBAR_MENU:"#header-view-navbar-menu",FOOTER_VIEW:"#footer-view",FOOTER_VIEW_COPYRIGHT:"#footer-view-copyright",PAGE_VIEW:"#page-view",SEARCH_VIEW:"#search-view",ERROR_VIEW:"#error-view",ERROR_VIEW_TITLE:"h1",ERROR_VIEW_MESSAGE:"div.alert",BLOG_NAVIGATION_VIEW:"#blog-navigation-view",ALL_POSTS_SECTION:"#all-posts",ALL_POSTS_SECTION_TITLE:"#all-posts-title > a",CATEGORIES_SECTION:"#categories",CATEGORIES_SECTION_TITLE:"#categories-title",ARCHIVE_SECTION:"#archive",ARCHIVE_SECTION_TITLE:"#archive-title",RSS_SECTION:"#rss",RSS_SECTION_TITLE:"#rss-title > a",BLOG_LIST_VIEW:"#blog-list-view",BLOG_LIST_TEMPLATE:"#blog-list-template",BLOG_PAGER:"#blog-pager",BLOG_PAGER_SIZES:"span.k-pager-sizes select",BLOG_POST_READMORE:"div.readmore > div.pull-right > a",BLOG_POST_VIEW:"#post-view",COMMENTS_VIEW:"#comments-view",DUMMY:"dummy"})}(jQuery),function(a,b){"use strict";var c=Function,d=c("return this")(),e=d.kendo,f=d.app,g=f.config,h=f.constants,i=f.elements,j=f.events,k=f.routes,l=f.types,m=!1,n="app.controller.js: ",o={set:function(a,b){Modernizr.localstorage&&(d.localStorage[a]=b)},get:function(a){return Modernizr.localstorage?d.localStorage[a]:b}};a(document).on(j.INITIALIZE,function(){m&&d.console&&console.log(n+"initialize event fired"),f.localize(f.config);var b=new e.Layout(i.APPLICATION_LAYOUT),c=new e.View(i.HEADER_VIEW,{model:f.searchViewModel}),p=new e.View(i.FOOTER_VIEW),q=new e.View(i.PAGE_VIEW,{model:f.contentViewModel}),r=new e.View(i.SEARCH_VIEW,{model:f.searchViewModel}),s=new e.View(i.ERROR_VIEW),t=new e.View(i.BLOG_NAVIGATION_VIEW,{model:f.blogNavigationViewModel}),u=new e.View(i.BLOG_LIST_VIEW,{model:f.blogListViewModel}),v=new e.View(i.BLOG_POST_VIEW,{model:f.contentViewModel}),w=new e.View(i.COMMENTS_VIEW,{model:f.contentViewModel}),x=new e.Router({init:function(){b.render(i.APPLICATION_ROOT),b.showIn(i.APPLICATION_HEADER,c),b.showIn(i.APPLICATION_FOOTER,p),b.showIn(i.APPLICATION_COMMENTS,w),b.showIn(i.APPLICATION_SIDE,t)},change:function(b){m&&d.console&&d.console.log(n+"Open view "+b.url);var c=a("#analytics").data("kendoAnalytics");c instanceof e.ui.Analytics&&a.type(c.options.pubId)===l.STRING&&c.send(window.location.protocol+"//"+window.location.host+window.location.pathname+k.HASH+b.url)},routeMissing:function(a){m&&d.console&&d.console.log(n+"Route missing at "+a.url),b.showIn(i.APPLICATION_CONTENT,s)}});m&&d.console&&console.log(n+"views and router initialized"),x.route(k.HOME,function(){if(a.type(f.config.paths.home)===l.STRING&&f.config.paths.home.length>0)f.contentViewModel.set("contentUrl",g.paths.root+g.paths.pages+f.config.paths.home),b.showIn(i.APPLICATION_CONTENT,q),b.showIn(i.APPLICATION_COMMENTS,w),t.hide();else{var c=f.blogListViewModel.get("list");c.filter(null),c.sort()||c.sort({field:"pubDate",dir:"desc"}),c.pageSize(o.get(h.PAGE_SIZE)||h.DEFAULT_PAGE_SIZE),b.showIn(i.APPLICATION_CONTENT,u),w.hide(),b.showIn(i.APPLICATION_SIDE,t)}}),x.route(k.PAGE,function(a){f.contentViewModel.set("contentUrl",g.paths.root+g.paths.pages+a+h.MARKDOWN_EXT),b.showIn(i.APPLICATION_CONTENT,q),b.showIn(i.APPLICATION_COMMENTS,w),t.hide()}),x.route(k.CATEGORY,function(a){var c=f.blogListViewModel.get("list");c.filter({field:"category",operator:"eq",value:a}),c.pageSize(o.get(h.PAGE_SIZE)||h.DEFAULT_PAGE_SIZE),b.showIn(i.APPLICATION_CONTENT,u),w.hide(),b.showIn(i.APPLICATION_SIDE,t)}),x.route(k.BLOG,function(c,d,e){var j=f.blogListViewModel.get("list");if(a.type(e)===l.STRING){var k=a.grep(j.data(),function(a){return a.link.indexOf(c+h.PATH_SEP+d+h.PATH_SEP+e)>0});k.length>0&&(f.contentViewModel.set("contentUrl",g.paths.root+g.paths.posts+c+h.PATH_SEP+d+h.PATH_SEP+e+h.MARKDOWN_EXT),b.showIn(i.APPLICATION_CONTENT,v),b.showIn(i.APPLICATION_COMMENTS,w))}else j.filter(isNaN(parseInt(d))?isNaN(parseInt(c))?null:{field:"period",operator:"startsWith",value:c}:{field:"period",operator:"eq",value:c+"/"+d}),j.sort()||j.sort({field:"pubDate",dir:"desc"}),j.pageSize(o.get(h.PAGE_SIZE)||h.DEFAULT_PAGE_SIZE),b.showIn(i.APPLICATION_CONTENT,u),w.hide();b.showIn(i.APPLICATION_SIDE,t)}),x.route(k.GUID,function(a){var c=f.blogListViewModel.get("list"),d=c.get(a);if(d){var e=new RegExp(k.HASH+k.BLOG.replace(k.YEAR_PARAMETER,"([^/]+)").replace(k.MONTH_PARAMETER,"([^/]+)").replace(k.SLUG_PARAMETER,"([^/]+)")+"$"),j=e.exec(d.link);f.contentViewModel.set("contentUrl",g.paths.root+g.paths.posts+j[1]+h.PATH_SEP+j[2]+h.MARKDOWN_EXT),b.showIn(i.APPLICATION_CONTENT,v),b.showIn(i.APPLICATION_COMMENTS,w),b.showIn(i.APPLICATION_SIDE,t)}}),x.route(k.SEARCH,function(){b.showIn(i.APPLICATION_CONTENT,r),w.hide(),t.hide()}),m&&d.console&&d.console.log(n+"routes configured"),a(window).keydown(function(b){return 13==b.keyCode?(a(i.HEADER_VIEW_NAVBAR_SEARCH_INPUT).val().trim().length>0&&a(i.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).trigger(j.CLICK),b.preventDefault(),!1):!0});var y=function(b){m&&d.console.log&&d.console.log(n+"new markdown loaded");var c=b.sender.metadata(),g=new Date(c.pubDate);f.contentViewModel.set("title",a.type(c.title)===l.STRING?c.title:""),f.contentViewModel.set("author",a.type(c.author)===l.STRING?c.author:""),f.contentViewModel.set("pubDate",a.type(g)!==l.DATE||isNaN(g.getTime())?e.toString(new Date,h.DATE_FORMAT):e.toString(g,h.DATE_FORMAT)),f.contentViewModel.set("identifier",a.type(c.guid)===l.STRING?c.guid:""),f.setMetaTags(c,f.config)};q.bind(j.INIT,function(a){a.sender.element.find("[data-role=markdown]").data("kendoMarkDown").bind(j.CHANGE,y)}),v.bind(j.INIT,function(a){a.sender.element.find("[data-role=markdown]").data("kendoMarkDown").bind(j.CHANGE,y)}),t.bind(j.SHOW,function(){m&&d.console.log&&d.console.log(n+"blog navigation shown"),a(i.APPLICATION_MAIN).removeClass("col-lg-12 col-md-12 col-sm-12"),a(i.APPLICATION_MAIN).addClass("col-lg-10 col-md-9 col-sm-8 spacing"),a(i.APPLICATION_SIDE).removeClass("hidden"),a(i.APPLICATION_SIDE).addClass("col-lg-2 col-md-3 col-sm-4")}),t.bind(j.HIDE,function(){m&&d.console.log&&d.console.log(n+"blog navigation hidden"),a(i.APPLICATION_MAIN).removeClass("col-lg-10 col-md-9 col-sm-8 spacing"),a(i.APPLICATION_MAIN).addClass("col-lg-12 col-md-12 col-sm-12"),a(i.APPLICATION_SIDE).removeClass("col-lg-2 col-md-3 col-sm-4"),a(i.APPLICATION_SIDE).addClass("hidden")}),a(i.HEADER_VIEW_NAVBAR_SEARCH_INPUT).bind(j.KEYUP,function(b){a(b.target).val().trim().length>0?a(i.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).removeClass("disabled"):a(i.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).addClass("disabled")}),a(i.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).bind(j.CLICK,function(){x.navigate(k.SEARCH)}),a(i.BLOG_PAGER).find(i.BLOG_PAGER_SIZES).bind(j.CHANGE,function(a){o.set(h.PAGE_SIZE,e.parseInt(a.target.value))}),m&&d.console&&console.log(n+"events bound"),x.start(),m&&d.console&&d.console.log(n+"router started")})}(jQuery),function(a){"use strict";var b=Function,c=b("return this")(),d=c.kendo,e=c.app,f=e.elements,g=e.tags,h=e.types,i="<wrap>",j="</wrap>",k=!1,l="app.localizer.js: ";e.localize=function(b){k&&c.console&&c.console.log(l+"starting localization; config and external templates should have been loaded beforehand"),d.culture(b.language);var e;if(1===a(f.HEADER_VIEW).length){e=a(i+a(f.HEADER_VIEW).html()+j),e.find(f.HEADER_VIEW_NAVBAR_BRAND+" "+g.IMG).attr(g.SRC,b.paths.root+b.paths.logo).attr(g.ALT,b.title),e.find(f.HEADER_VIEW_NAVBAR_TOGGLE).html(b.blog.navigation.toggle),Modernizr.input.placeholder&&e.find(f.HEADER_VIEW_NAVBAR_SEARCH_INPUT).attr(g.PLACEHOLDER,b.search.placeholder),e.find(f.HEADER_VIEW_NAVBAR_SEARCH_BUTTON).html(b.search.button);var m=e.find(f.HEADER_VIEW_NAVBAR_MENU);a.each(b.menu,function(b,c){if(a.type(c.href)!==h.STRING||c.items){if(!c.href&&a.isArray(c.items)&&c.items.length>0){var e=a('<li class="dropdown"></li>');e.append(d.format('<a href="#" class="dropdown-toggle" data-toggle="dropdown">{0}<b class="caret"></b></a>',c.text));var f=a('<ul class="dropdown-menu"></ul>');a.each(c.items,function(a,b){f.append(b.text&&b.href?d.format('<li><a href="{0}">{1}</a></li>',b.href,b.text):'<li class="divider"></li>')}),e.append(f),m.append(e)}}else m.append(d.format('<li><a href="{0}">{1}</a></li>',c.href,c.text))}),a(f.HEADER_VIEW).html(e.html())}1===a(f.FOOTER_VIEW).length&&(e=a(i+a(f.FOOTER_VIEW).html()+j),e.find(f.FOOTER_VIEW_COPYRIGHT).html(b.copyright),a(f.FOOTER_VIEW).html(e.html())),1===a(f.ERROR_VIEW).length&&(e=a(i+a(f.ERROR_VIEW).html()+j),e.find(f.ERROR_VIEW_TITLE).html(b.errors.error404.title),e.find(f.ERROR_VIEW_MESSAGE).html(b.errors.error404.message),a(f.ERROR_VIEW).html(e.html())),1===a(f.BLOG_NAVIGATION_VIEW).length&&(e=a(i+a(f.BLOG_NAVIGATION_VIEW).html()+j),e.find(f.ALL_POSTS_SECTION_TITLE).html(b.blog.navigation.allposts),e.find(f.CATEGORIES_SECTION_TITLE).html(b.blog.navigation.categories),e.find(f.ARCHIVE_SECTION_TITLE).html(b.blog.navigation.archive),e.find(f.RSS_SECTION_TITLE).html(b.blog.navigation.rssfeed).attr(g.HREF,b.paths.root+b.paths.posts+b.paths.rss),a(f.BLOG_NAVIGATION_VIEW).html(e.html())),1===a(f.BLOG_LIST_TEMPLATE).length&&(e=a(i+a(f.BLOG_LIST_TEMPLATE).html()+j),e.find(f.BLOG_POST_READMORE).html(b.blog.readmore),a(f.BLOG_LIST_TEMPLATE).html(e.html())),k&&c.console&&c.console.log(l+"localization completed")},e.setMetaTags=function(b,c){var d=a(g.HEAD);if(d.length>0&&(b.title||c.title)){var e=d.find(g.TITLE);0===e.length&&(e=a(g.TITLE_ELEMENT),d.prepend(e)),e.text(b.title||c.title)}var f=a(g.ARTICLE+" "+g.HEADING1);f.length>0&&(b.title||c.title)&&f.text(b.title||c.title)}}(jQuery),function(a){"use strict";var b=Function,c=b("return this")(),d=c.kendo,e=c.app,f=e.config,g=e.constants,h=e.routes,i=e.types,j=!1,k="app.index.viewmodels.js: ",l=new d.data.DataSource({}),m=new d.data.DataSource({}),n=new d.data.DataSource({}),o=new d.data.DataSource({transport:{read:{url:f.paths.root+f.paths.posts+f.paths.rss,dataType:"xml"}},schema:{type:"xml",data:"/rss/channel/item",model:{id:"guid",fields:{guid:{field:"guid/text()",type:i.STRING,editable:!1,defaultValue:g.DEFAULT_GUID,parse:function(a){if(0===a.indexOf(g.URN)){var b=a.substr(g.URN.length).indexOf(g.COLON);if(b>0)return a.substr(g.URN.length+b+1)}return a}},title:{field:"title/text()",type:i.STRING,editable:!1},link:{field:"link/text()",type:i.STRING,editable:!1,parse:function(b){if(a.type(b)===i.STRING){var c=b.indexOf(h.HASH);if(c>=0)return b.substr(c)}return b}},description:{field:"description/text()",type:i.STRING,editable:!1},enclosure:{field:"enclosure/@url",type:i.STRING,editable:!1,parse:function(b){return a.type(b)===i.STRING?b:d.format(f.paths.root+f.paths.thumbnail,Math.floor(1+g.MAX_THUMBNAILS*Math.random()))}},author:{field:"author/text()",type:i.STRING,editable:!1},pubDate:{field:"pubDate/text()",type:i.DATE,editable:!1,parse:function(a){return j&&c.console.log&&c.console.log(k+"parse value "+a),d.parseDate(a)}},period:{field:"pubDate/text()",type:i.STRING,editable:!1,parse:function(a){var b=d.parseDate(a);return d.toString(b,"yyyy/MM")}},category:{field:"category/text()",type:i.STRING,editable:!1}}}},change:function(a){j&&c.console&&console.log(k+"Fetched "+a.items.length+" blogs"),a.sender instanceof d.data.DataSource&&(l.data(a.sender.data()),l.group({field:"category"}),m.data(a.sender.data()),m.group({field:"period"}),n.data(a.sender.data()))},error:function(b){j&&c.console&&a.type(c.console.error)===i.FUNCTION&&c.console.error(k+"error "+b.errorThrown)}});o.read(),e.searchViewModel=d.observable({search:""}),e.blogNavigationViewModel=d.observable({_categories:l,categories:function(){return this.get("_categories").view()},_archive:m,archive:function(){return this.get("_archive").view()}}),e.blogListViewModel=d.observable({list:n}),e.contentViewModel=d.observable({url:"",contentUrl:"",title:"",author:"",pubDate:Date.now(),identifier:""})}(jQuery);