<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Add test to query string</title>
    <script>
        window.app = { DEBUG: true };
    </script>
    <!-- Memba fonts -->
    <link href="../../../src/styles/fonts/memba.css" rel="stylesheet">
    <!-- Application theme -->
    <link href="../../../src/styles/themes/app.theme.nordic.css" rel="stylesheet">
    <!-- Mocha css -->
    <link href="../../vendor/mocha.css" rel="stylesheet" />
    <!-- SystemJS loader -->
    <script src="../../vendor/polyfill.min.js"></script>
    <script src="../../vendor/system.js"></script>
    <script src="../../../src/js/helpers/system.config.js"></script>
    <script>
        (function () {
            'use strict';
            SystemJS.import('mocha').then(function (args) {
                var mocha = args.mocha;
                // Help SystemJS export mocha globals
                // https://staxmanade.com/2015/09/browser-only-mochajs-tests-using-systemjs/
                mocha.suite.on('pre-require', function (context) {
                    var exports = window;
                    exports.afterEach = context.afterEach || context.teardown;
                    exports.after = context.after || context.suiteTeardown;
                    exports.beforeEach = context.beforeEach || context.setup;
                    exports.before = context.before || context.suiteSetup;
                    exports.describe = context.describe || context.suite;
                    exports.it = context.it || context.test;
                    exports.setup = context.setup || context.beforeEach;
                    exports.suiteSetup = context.suiteSetup || context.before;
                    exports.suiteTeardown = context.suiteTeardown || context.after;
                    exports.suite = context.suite || context.describe;
                    exports.teardown = context.teardown || context.afterEach;
                    exports.test = context.test || context.it;
                    exports.run = context.run;
                    const params = 'URLSearchParams' in window ?
                        new URLSearchParams(window.location.search) :
                        {
                            // Especially for Internet Explorer
                            get: function (name) {
                                const match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
                                return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
                            }
                        };
                    const test = params.get('t');
                    if (test) {
                        document.title = test;
                        document.getElementsByTagName('h1')[0].innerHTML = test;
                        document.getElementById('menu').style.display = 'none';
                        // now use SystemJS to load all test files
                        SystemJS.import('./' + test + '.test.es6').then(function() {
                            mocha.checkLeaks().globals(['requestFileSystem', 'storageInfo']);
                            mocha.run();
                        });
                    }
                });
                mocha.setup('bdd');
                mocha.timeout(10000);
            });
        }());
    </script>
</head>
<body>
<h1>Add test to query string ?t=[name] (from [name].test.es6)</h1>
<ul id="menu">
    <li><a href="?t=sample">sample</a></li>
</ul>
<div id="mocha"></div>
<div id="fixtures"></div>
</body>
</html>
